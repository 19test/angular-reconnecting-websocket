// https://github.com/abachman/reconnecting-websocket/
(function(){var e=this;var n=function(e,t){t=t||[];this.debug=false;this.timeoutInterval=2e3;this.reconnectInterval=this.initialReconnectInterval=5e3;this.maxReconnectInterval=5*60*1e3;var o=0;this.url=e;this.protocols=t;this.URL=e;this.onopen=function(){};this.onclose=function(){};this.onconnecting=function(){};this.onmessage=function(){};this.onerror=function(){};this.onreconnect=function(){};var c;var r=false;var i=false;var a=this;var s=function(){if(a.debug||n.debugAll){var e=Array.prototype.slice.call(arguments);e.unshift("[ReconnectingWebSocket]");console.debug.apply(console,e)}};var l=function(){var e=Math.random()+1,n=a.initialReconnectInterval,t=2,c=o,r=a.maxReconnectInterval;s("updating reconnectInterval with",e,n,t,c,r);a.reconnectInterval=Math.min(e*n*Math.pow(t,c),r);s("reconnectInterval updated",a.reconnectInterval,"attempt",o);o++};var u=function(n){c=new WebSocket(e,t);a.readyState=c.readyState;a.onconnecting();s("attempt to connect",e);var f=c;var h=setTimeout(function(){s("connection timeout",e);i=true;f.close();i=false},a.timeoutInterval);c.onopen=function(t){s("ws.onopen",e);a.readyState=c.readyState;clearTimeout(h);n=false;a.onopen(t)};c.onclose=function(t){s("ws.onclose");a.readyState=c.readyState;clearTimeout(h);c=null;if(r){a.onclose(t)}else{a.readyState=WebSocket.CONNECTING;a.onconnecting();if(!(n||i)){s("onclose",e);a.onclose(t)}a.onreconnect(o+1,a.reconnectInterval);reconnectionAttemptTimeout=setTimeout(function(){u(true);l()},a.reconnectInterval)}};c.onmessage=function(n){s("ws.onmessage",e,n.data);a.onmessage(n)};c.onerror=function(n){s("ws.onerror",e,n);a.onerror(n)}};u(e);this.send=function(n){if(c){s("this.send",e,n);return c.send(n)}else{throw new Error("INVALID_STATE_ERR : Pausing to reconnect websocket")}};this.close=function(){if(c){r=true;c.close()}};this.refresh=function(){if(c){c.close()}}};e.ReconnectingWebSocket=n}).call(this);
